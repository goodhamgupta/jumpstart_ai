# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an AI agent application for Financial Advisors built with Elixir Phoenix and the Ash Framework. It integrates with Gmail, Google Calendar, and HubSpot to provide a ChatGPT-like interface for managing client relationships and automating tasks.

## Development Commands

- `mix setup` - Install dependencies and setup the project
- `mix phx.server` - Start the development server (runs on http://localhost:4000)
- `iex -S mix phx.server` - Start server in interactive shell
- `mix test` - Run tests (uses ash.setup --quiet before running)
- `mix ash.setup` - Setup Ash resources and run migrations
- `docker-compose up` - Start PostgreSQL database locally

### Asset Commands
- `mix assets.setup` - Install Tailwind and esbuild
- `mix assets.build` - Build assets for development
- `mix assets.deploy` - Build and minify assets for production

### Database Commands
- `mix ecto.setup` - Create database, run migrations, and seed data
- `mix ecto.reset` - Drop and recreate database with fresh data
- `mix ash.setup` - Preferred over ecto commands as it handles Ash resources

## Architecture

### Framework Stack
- **Phoenix Framework**: Web framework with LiveView for real-time UI
- **Ash Framework**: Resource-based framework for building APIs and business logic
- **AshAuthentication**: Handles user authentication with Google OAuth and password strategies
- **Oban**: Background job processing with AshOban integration
- **Postgres**: Database with extensions for vector search (pgvector for RAG)

### Key Components

#### Domains and Resources
- `JumpstartAi.Accounts` - User management domain
  - `JumpstartAi.Accounts.User` - User resource with Google OAuth and password authentication
  - `JumpstartAi.Accounts.Token` - Token management for authentication

#### Authentication
- Google OAuth strategy configured for Gmail and Calendar access
- Password-based authentication with confirmation emails
- Token-based session management
- Authentication routes at `/auth/*`

#### Configuration
- Environment-specific configs in `config/`
- Secrets managed through `JumpstartAi.Secrets` module
- Google OAuth credentials configured via environment variables:
  - `:google_client_id`
  - `:google_client_secret` 
  - `:google_redirect_uri`
  - `:token_signing_secret`

### Directory Structure
- `lib/jumpstart_ai/` - Core business logic and Ash domains
- `lib/jumpstart_ai_web/` - Phoenix web layer (controllers, live views, components)
- `assets/` - Frontend assets (CSS, JS, Tailwind config)
- `priv/repo/migrations/` - Database migrations
- `priv/resource_snapshots/` - Ash resource state snapshots

## Development Notes

### Ash Framework Patterns
- Resources define data structures, actions, and business logic
- Domains group related resources
- Actions (create, read, update, delete) are explicitly defined with validations and changes
- Policies control authorization
- Use `ash.setup` for database operations instead of raw ecto commands

### Authentication Integration
- Authentication routes are automatically generated by AshAuthentication.Phoenix
- LiveView authentication uses `ash_authentication_live_session` 
- API routes use bearer token authentication via `:load_from_bearer` plug

### Background Jobs
- Oban configured for background processing
- AshOban integration allows resources to define and trigger jobs
- Jobs configured in `config/config.exs` with basic engine and postgres notifier